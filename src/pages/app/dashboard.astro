---
import AppLayout from '../../layouts/AppLayout.astro';
import SiteHeader from '../../components/ui/SiteHeader';
import UserDashboard from '../../components/dashboard/Dashboard';

// 1. Protección de Ruta (Server Side)
// const { cookies, redirect } = Astro;

// Supabase Auth Helper para SSR (Básico)
// const accessToken = cookies.get("sb-access-token");
// const refreshToken = cookies.get("sb-refresh-token");

// NOTA: Para producción real con SSR estricto necesitaríamos más configuración,
// pero por ahora confiaremos en la redirección del cliente si falla.

// 2. Obtener CVs del usuario
// Usamos el cliente admin/anon pero filtrado por RLS (Row Level Security)
// que configuramos en SQL. Necesitamos la sesión activa.
// Como estamos en modo híbrido, haremos el fetch en el cliente (React)
// o aquí si configuramos las cookies de Supabase.
---

<AppLayout title="Mis Currículums - CVStudio">
  <SiteHeader client:load />

  <main class="container mx-auto px-4 pt-24 pb-12">
    <UserDashboard client:load />
  </main>
</AppLayout>
